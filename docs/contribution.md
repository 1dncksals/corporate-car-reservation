# 내 기여도 및 기술적 의사결정

## 전체 API 명세 작성

### 작업 내용
OpenAPI 3.0 형식으로 REST API 전체 명세를 작성했습니다. 총 20개 이상의 엔드포인트를 정의하고, 각 엔드포인트의 요청/응답 스키마, 권한 요구사항, 에러 응답을 상세히 명세했습니다.

### 기술적 의사결정

#### 1. 권한별 엔드포인트 분리
**문제**: 초기 설계에서는 사용자와 관리자의 권한 체크가 각 엔드포인트에 산재되어 있어 복잡도가 높았습니다.

**의사결정**: `/user/*`와 `/admin/*` 네임스페이스로 구조화하여 권한별 엔드포인트를 명확히 분리했습니다.

**효과**:
- API 구조가 명확해져 프론트엔드 개발자가 쉽게 이해할 수 있음
- 권한 체크 로직이 단순해져 유지보수 용이
- API 문서에서 권한별 기능을 한눈에 파악 가능

#### 2. 충돌 응답 구조 설계
**의사결정**: 예약 충돌 발생 시 단순 에러 메시지가 아닌, 충돌 정보와 대체 차량 제안을 포함한 구조화된 응답을 설계했습니다.

**응답 구조**:
- 충돌 코드 및 메시지
- 충돌 상세 정보 (충돌 예약 ID, 충돌 시간)
- 대체 차량 제안 목록 (사용 가능한 차량, 사용 가능 시간)

**효과**:
- 사용자가 즉시 대안을 확인하고 재예약 가능
- UI에서 충돌 정보를 시각적으로 표현하기 용이

#### 3. 상태 코드 및 에러 코드 체계
**의사결정**: HTTP 상태 코드와 비즈니스 에러 코드를 분리하여 설계했습니다.

**에러 코드 체계**:
- `RESV_001`: 예약 시간 유효성 오류
- `RESV_002`: 예약 충돌
- `RESV_003`: 차량 관련 오류
- `RESV_004`: 예약을 찾을 수 없음
- `AUTO_001`: 자동 연장 한도 초과
- `AUTO_002`: 후속 예약 충돌

**효과**:
- 프론트엔드에서 에러 타입별로 다른 처리 가능
- 사용자에게 명확한 에러 메시지 제공

## 사용자/관리자 UI 플로우 설계

### 작업 내용
사용자와 관리자의 화면을 분리하고, 예약 생성, 수정, 취소 등 주요 플로우를 설계했습니다. 특히 의사결정에 필요한 정보를 우선적으로 설계하여 사용자가 빠르게 예약을 생성할 수 있도록 했습니다.

### 기술적 의사결정

#### 1. 의사결정 정보 우선 설계
**문제**: 초기 UI 설계에서는 사용자가 예약 가능 여부를 판단하기 어려웠습니다. 차량 목록만 보여주고 예약 가능 시간대나 충돌 정보가 없어 사용자가 여러 차량을 클릭해봐야 하는 불편함이 있었습니다.

**의사결정**: 예약 생성 화면에서 다음 정보를 우선적으로 표시하도록 설계했습니다:
- 차량별 현재 예약 현황
- 예약 가능한 시간대 (시각적으로 표시)
- 예약 중인 차량의 다음 예약 시간
- 차량별 좌석 수 및 버퍼 시간

**효과**:
- 사용자가 한 화면에서 예약 가능 여부를 즉시 판단 가능
- 불필요한 클릭 및 페이지 이동 감소
- 예약 성공률 향상

#### 2. 권한별 화면 분리
**의사결정**: 사용자와 관리자의 화면을 완전히 분리하여 각 역할에 맞는 기능만 제공하도록 설계했습니다.

**화면 구조**:
- 사용자 화면: `/user/*` 경로
  - 대시보드 (내 예약 현황)
  - 예약 생성/수정
  - 내 예약 관리
  - 동승 관리
- 관리자 화면: `/admin/*` 경로
  - 전체 예약 관리
  - 차량 관리
  - 사용자 관리
  - 통계 대시보드

**효과**:
- 각 역할에 맞는 최적화된 UI 제공
- 불필요한 기능 노출 방지로 사용자 혼란 감소
- 권한 관리가 명확해져 보안 강화

#### 3. 예약 상태 시각화
**의사결정**: 예약 상태를 색상과 아이콘으로 시각화하여 사용자가 한눈에 예약 상태를 파악할 수 있도록 설계했습니다.

**상태 표시**:
- RESERVED: 파란색 (예약됨)
- IN_USE: 초록색 (사용 중)
- COMPLETED: 회색 (완료됨)
- CANCELED: 빨간색 (취소됨)

**효과**:
- 직관적인 상태 파악
- 사용자 경험 향상

## 예약 충돌 처리 규칙 정의

### 작업 내용
예약 시간이 겹칠 때의 처리 규칙을 정의했습니다. 선점, 자동 연장, 관리자 승인 등 다양한 정책을 수립하고, 우선순위 알고리즘을 설계했습니다.

### 기술적 의사결정

#### 1. 충돌 처리 정책 수립
**문제**: 초기에는 예약 시간 충돌 시 처리 방법이 명확하지 않았습니다. 단순히 에러를 반환하는 것만으로는 사용자 경험이 좋지 않았습니다.

**의사결정**: 다음과 같은 정책을 수립했습니다:

**선점 정책**:
- 먼저 예약한 사용자가 우선권을 가짐
- 동시 예약 시 데이터베이스 제약으로 차단

**자동 연장 정책**:
- 반납 지연 시 30분씩 자동 연장 (최대 2회, 총 60분)
- 연장 시 다음 예약자에게 알림 발송
- 충돌 발생 시 대체 차량 자동 제안

**관리자 승인 정책**:
- 관리자가 충돌 상황을 판단하여 처리
- 긴급 예약의 경우 관리자 승인으로 우선 처리 가능

**효과**:
- 다양한 상황에 유연하게 대응 가능
- 사용자 편의성 향상
- 관리자의 개입이 필요한 경우에만 관리자에게 전달

#### 2. 우선순위 알고리즘 설계
**의사결정**: 동시 예약 시 우선순위를 결정하는 알고리즘을 설계했습니다.

**우선순위 규칙** (우선순위 높은 순):
1. 긴급 예약 (`is_urgent = true`)
2. 긴 예약 기간 (긴 시간 예약자가 우선)
3. 직책 순위 (`position_rank` 높은 순)

**효과**:
- 공정한 예약 배정
- 비즈니스 요구사항 반영 (긴급 예약 우선 처리)

#### 3. 대체 차량 자동 제안 로직
**의사결정**: 충돌 발생 시 단순 에러가 아닌 대체 차량을 자동으로 검색하여 제안하도록 설계했습니다.

**제안 로직**:
1. 충돌 시간대에 사용 가능한 다른 차량 검색
2. 동일 차종 우선 검색
3. 사용 가능 시간이 가장 가까운 차량 우선 제안

**효과**:
- 사용자가 즉시 재예약 가능
- 예약 성공률 향상
- 사용자 만족도 향상

## 데이터베이스 설계 기여

### 작업 내용
ERD 설계에 참여하여 예약 충돌 방지를 위한 데이터베이스 제약을 설계했습니다.

### 기술적 의사결정

#### 1. EXCLUDE USING GIST 제약 활용
**의사결정**: 애플리케이션 레벨에서만 충돌을 검사하는 것은 동시성 문제가 발생할 수 있어, 데이터베이스 레벨에서 `EXCLUDE USING GIST` 제약을 활용하여 중복 예약을 완전히 차단하도록 설계했습니다.

**효과**:
- 동시 요청 시에도 안전하게 충돌 방지
- 데이터 무결성 보장
- 애플리케이션 로직 단순화

#### 2. 버퍼 시간 자동 계산 트리거
**의사결정**: 차량별 버퍼 시간을 포함한 종료 시간(`end_with_buffer`)을 트리거로 자동 계산하도록 설계했습니다.

**효과**:
- 버퍼 시간 변경 시 자동 반영
- 데이터 일관성 보장
- 애플리케이션 로직 단순화

## 문서화 기여

### 작업 내용
프로젝트의 전체 문서화를 담당했습니다. API 명세서, ERD 설계 문서, 프로젝트 개요 문서 등을 작성했습니다.

### 기술적 의사결정

#### 1. OpenAPI 명세서 우선 작성
**의사결정**: 코드 구현 전에 OpenAPI 명세서를 먼저 작성하여 프론트엔드와 백엔드 개발자 간의 인터페이스를 명확히 정의했습니다.

**효과**:
- 프론트엔드와 백엔드 개발 병렬 진행 가능
- 인터페이스 변경 시 영향 범위 명확
- API 문서 자동 생성 가능 (Swagger UI)

#### 2. DBML 형식 ERD 설계
**의사결정**: ERD를 DBML 형식으로 작성하여 버전 관리가 가능하도록 했습니다.

**효과**:
- ERD 변경 이력 추적 가능
- 데이터베이스 스키마 문서화
- 마이그레이션 스크립트 생성 용이

